{
	"info": {
		"_postman_id": "a0cdefe0-9d12-474b-b529-838b704e63d6",
		"name": "BlogTP API  - Postman Collection",
		"description": "환경변수(host/port) 기반 baseUrl 자동 설정 + 토큰 저장/주입 + 응답검증 스크립트 포함(5개 이상).",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "49079290",
		"_collection_link": "https://skeey66-3390440.postman.co/workspace/skeey66's-Workspace~e6597115-9fca-40e8-8bbd-dcedb1fd7cf2/collection/49079290-a0cdefe0-9d12-474b-b529-838b704e63d6?action=share&source=collection_link&creator=49079290"
	},
	"item": [
		{
			"name": "00 Health (Actuator)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test(\"status 200\", function () {",
							"  pm.response.to.have.status(200);",
							"});",
							"const json = pm.response.json();",
							"pm.test(\"status is UP\", function () {",
							"  pm.expect(json.status).to.eql(\"UP\");",
							"});"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/actuator/health",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"actuator",
						"health"
					]
				}
			},
			"response": []
		},
		{
			"name": "01 Signup (Random User)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const ts = Date.now();",
							"pm.environment.set(\"userEmail\", `user_${ts}@blogtp.local`);",
							"if (!pm.environment.get(\"userPassword\")) {",
							"  pm.environment.set(\"userPassword\", \"user1234\");",
							"}"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('status is 201 Created', function () {",
							"  pm.expect(pm.response.code).to.eql(201);",
							"});",
							"",
							"if (pm.response.code === 201 || pm.response.code === 200) {",
							"  const json = pm.response.json();",
							"  pm.environment.set('userAccessToken', json.accessToken);",
							"  pm.environment.set('userRefreshToken', json.refreshToken);",
							"  pm.test('tokens saved', function () {",
							"    pm.expect(json.accessToken).to.be.ok;",
							"  });",
							"}"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"{{userEmail}}\",\n  \"password\": \"{{userPassword}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/signup",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"auth",
						"signup"
					]
				}
			},
			"response": []
		},
		{
			"name": "02 Login (Admin)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"if (pm.response.code === 200) {",
							"  const json = pm.response.json();",
							"  pm.environment.set('adminAccessToken', json.accessToken);",
							"  pm.environment.set('adminRefreshToken', json.refreshToken);",
							"  pm.test('admin login OK', function () {",
							"    pm.expect(json.accessToken).to.be.ok;",
							"  });",
							"} else {",
							"  // Many assignments seed admin differently. If you get 404/401, set adminEmail/adminPassword in the environment to match your DB seed.",
							"  pm.environment.unset('adminAccessToken');",
							"  pm.environment.unset('adminRefreshToken');",
							"  pm.test('admin login skipped (set adminEmail/adminPassword if needed)', function () {",
							"    pm.expect(true).to.be.true;",
							"  });",
							"  console.log('Admin login failed/skipped. status=', pm.response.code, 'body=', pm.response.text());",
							"}"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"{{adminEmail}}\",\n  \"password\": \"{{adminPassword}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/login",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"auth",
						"login"
					]
				}
			},
			"response": []
		},
		{
			"name": "03 Create Category (Admin)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const token = pm.environment.get(\"adminAccessToken\");",
							"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });",
							"",
							"const ts = Date.now();",
							"pm.environment.set(\"categoryName\", `cat_${ts}`);"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const adminToken = pm.environment.get('adminAccessToken');",
							"if (!adminToken) {",
							"  pm.test('skipped (no admin token)', () => pm.expect(true).to.be.true);",
							"} else {",
							"  pm.test('status is 201 Created', function () {",
							"    pm.expect(pm.response.code).to.eql(201);",
							"  });",
							"  const json = pm.response.json();",
							"  pm.environment.set('categoryId', json.id);",
							"  pm.test('categoryId saved', function () {",
							"    pm.expect(json.id).to.be.a('number');",
							"  });",
							"}"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"name\": \"{{categoryName}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/categories",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"categories"
					]
				}
			},
			"response": []
		},
		{
			"name": "04 Create Post (User)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const token = pm.environment.get(\"userAccessToken\");",
							"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });",
							"",
							"const ts = Date.now();",
							"pm.environment.set(\"postTitle\", `Post ${ts}`);",
							"pm.environment.set(\"postContent\", `Hello BlogTP! created at ${ts}`);"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('status is 201 Created', function () {",
							"  pm.response.to.have.status(201);",
							"});",
							"",
							"const json = pm.response.json();",
							"const id = json.id ?? json.postId ?? json.post_id;",
							"pm.test('postId saved', function () {",
							"  pm.expect(id).to.be.a('number');",
							"});",
							"pm.environment.set('postId', id);"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"title\": \"{{postTitle}}\",\n  \"content\": \"{{postContent}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/posts",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"posts"
					]
				}
			},
			"response": []
		},
		{
			"name": "05 Add Comment (User)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const token = pm.environment.get(\"userAccessToken\");",
							"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });",
							"",
							"const ts = Date.now();",
							"pm.environment.set(\"commentContent\", `Nice post! ${ts}`);"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('status is 201 Created', function () {",
							"  pm.response.to.have.status(201);",
							"});",
							"",
							"const json = pm.response.json();",
							"const id = json.id ?? json.commentId ?? json.comment_id;",
							"pm.test('commentId saved', function () {",
							"  pm.expect(id).to.be.a('number');",
							"});",
							"pm.environment.set('commentId', id);"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"content\": \"{{commentContent}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/posts/{{postId}}/comments",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"posts",
						"{{postId}}",
						"comments"
					]
				}
			},
			"response": []
		},
		{
			"name": "06 Toggle Like (User)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const token = pm.environment.get(\"userAccessToken\");",
							"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('status is 200 OK', function () {",
							"  pm.response.to.have.status(200);",
							"});",
							"",
							"const json = pm.response.json();",
							"const likes = json.likes ?? json.likeCount ?? json.count;",
							"pm.test('likes is number', function () {",
							"  pm.expect(likes).to.be.a('number');",
							"});"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/posts/{{postId}}/likes",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"posts",
						"{{postId}}",
						"likes"
					]
				}
			},
			"response": []
		},
		{
			"name": "07 Add Bookmark (User)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const token = pm.environment.get(\"userAccessToken\");",
							"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('status is 201/204', function () {",
							"  pm.expect([201,204]).to.include(pm.response.code);",
							"});"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/posts/{{postId}}/bookmarks",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"posts",
						"{{postId}}",
						"bookmarks"
					]
				}
			},
			"response": []
		},
		{
			"name": "08 My Profile (User)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"const token = pm.environment.get(\"userAccessToken\");",
							"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('status 200', function () {",
							"  pm.expect(pm.response.code).to.eql(200);",
							"});",
							"const json = pm.response.json();",
							"pm.test('user email matches', function () {",
							"  pm.expect(json.email).to.eql(pm.environment.get('userEmail'));",
							"});"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/users/me",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"users",
						"me"
					]
				}
			},
			"response": []
		},
		{
			"name": "09 Daily Posts (Public)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test('status 200', function () {",
							"  pm.response.to.have.status(200);",
							"});",
							"",
							"const arr = pm.response.json();",
							"pm.test('response is array', function () {",
							"  pm.expect(arr).to.be.an('array');",
							"});",
							"if (arr.length > 0) {",
							"  const first = arr[0];",
							"  pm.test('first item has day/date and count', function () {",
							"    pm.expect(first).to.have.property('count');",
							"    pm.expect(first).to.satisfy(o => o.day !== undefined || o.date !== undefined);",
							"  });",
							"}"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/stats/daily-posts?days=7",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"stats",
						"daily-posts"
					],
					"query": [
						{
							"key": "days",
							"value": "7"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "10 Refresh Token (User)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test(\"status 200\", function () {",
							"  pm.response.to.have.status(200);",
							"});",
							"const json = pm.response.json();",
							"pm.environment.set(\"userAccessToken\", json.accessToken);",
							"pm.environment.set(\"userRefreshToken\", json.refreshToken);",
							"pm.test(\"rotated tokens saved\", function () {",
							"  pm.expect(pm.environment.get(\"userAccessToken\")).to.be.ok;",
							"  pm.expect(pm.environment.get(\"userRefreshToken\")).to.be.ok;",
							"});"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"refreshToken\": \"{{userRefreshToken}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/refresh",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"auth",
						"refresh"
					]
				}
			},
			"response": []
		},
		{
			"name": "11 Logout (User)",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test(\"status 204\", function () {",
							"  pm.response.to.have.status(204);",
							"});"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"refreshToken\": \"{{userRefreshToken}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/logout",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"auth",
						"logout"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Base URL 조립 (환경변수: scheme/host/port)",
					"const scheme = pm.environment.get(\"scheme\") || \"http\";",
					"const host = pm.environment.get(\"host\") || \"localhost\";",
					"const port = pm.environment.get(\"port\") || \"8080\";",
					"pm.environment.set(\"baseUrl\", `${scheme}://${host}:${port}`);"
				]
			}
		}
	]
}